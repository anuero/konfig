# Парсер конфигурационного языка - Вариант 16

## Общее описание

Инструмент командной строки для преобразования учебного конфигурационного языка в формат JSON. Поддерживает константы, математические выражения, массивы и комментарии.

**Основные возможности:**
- Парсинг пользовательского конфигурационного языка
- Преобразование в JSON формат
- Поддержка констант и их вычислений на этапе трансляции
- Вычисление математических выражений (инфиксная нотация)
- Обработка синтаксических ошибок с информативными сообщениями
- Поддержка комментариев (однострочных и многострочных)

## Синтаксис языка

### Комментарии

**Однострочные комментарии:**
```
; Это однострочный комментарий
```

**Многострочные комментарии:**
```
=begin
Это многострочный
комментарий
=end
```

### Типы данных

#### Числа
Поддерживаются целые, дробные и числа в научной нотации:
```
42              ; целое число
-17             ; отрицательное число
3.14            ; дробное число
.5              ; дробное число без целой части
2.5e10          ; научная нотация
1.5e-3          ; научная нотация с отрицательной экспонентой
```

**Регулярное выражение:** `-?(\d+|\d+\.\d*|\.\d+)([eE][-+]?\d+)?`

#### Массивы
Массивы определяются круглыми скобками с элементами через запятую:
```
()                    ; пустой массив
(1, 2, 3)            ; массив чисел
(1, (2, 3), 4)       ; вложенные массивы
```

#### Имена
Имена переменных/констант должны соответствовать паттерну:
```
[_a-zA-Z]+
```

Примеры корректных имён: `x`, `value`, `MY_CONST`, `_private`

### Константы

Объявление константы:
```
def имя = значение
```

Примеры:
```
def pi = 3.14159
def max_value = 100
def data = (1, 2, 3)
```

### Константные выражения

Вычисление выражений на этапе трансляции (инфиксная форма):
```
.[выражение].
```

**Поддерживаемые операции:**
1. **Сложение** (`+`): `.[x + 5].`
2. **Вычитание** (`-`): `.[y - 3].`
3. **Умножение** (`*`): `.[a * b].`
4. **Деление** (`/`): `.[total / count].`
5. **Функция len()**: `.[len(array)].` - возвращает длину массива или 1 для чисел

Примеры:
```
def x = 10
.[x + 5].           ; результат: 15
.[x * 2 + 3].       ; результат: 23
.[len((1, 2, 3))].  ; результат: 3
```

## Установка и настройка

### Требования
- Python 3.7+
- Библиотека `lark-parser`

### Установка зависимостей
```bash
pip install lark-parser
```

### Установка из репозитория
```bash
git clone <url-репозитория>
cd config-parser-v16
pip install -r requirements.txt
```

## Использование

### Базовый запуск

```bash
# Чтение из stdin, вывод в файл
python config_parser.py -o output.json < input.conf

# Чтение из stdin с использованием echo
echo "42" | python config_parser.py -o output.json

# Чтение из файла
cat example_physics.conf | python config_parser.py -o result.json
```

### Параметры командной строки

- `-o, --output` (обязательный) - путь к выходному JSON файлу

### Примеры использования

**Пример 1: Простые вычисления**
```bash
echo "
def x = 10
def y = 20
.[x + y].
(x, y, .[x * y].)
" | python config_parser.py -o output.json
```

Результат в `output.json`:
```json
[
  30,
  [10, 20, 200]
]
```

**Пример 2: Массивы и len()**
```bash
echo "
def data = (1, 2, 3, 4, 5)
data
.[len(data)].
" | python config_parser.py -o output.json
```

Результат:
```json
[
  [1, 2, 3, 4, 5],
  5
]
```

**Пример 3: Сложные выражения**
```bash
echo "
def a = 5
def b = 3
.[a * (b + 2)].
" | python config_parser.py -o output.json
```

Результат:
```json
[
  25
]
```

## Тестирование

### Запуск всех тестов
```bash
python test_parser.py
```

### Запуск отдельных тестов
```bash
# Тесты базовой функциональности
python -m unittest test_parser.TestConfigParser

# Тесты граничных случаев
python -m unittest test_parser.TestConfigParserEdgeCases

# Конкретный тест
python -m unittest test_parser.TestConfigParser.test_const_expr_addition
```

### Покрытие тестами

Тесты покрывают все конструкции языка:
- ✅ Однострочные комментарии
- ✅ Многострочные комментарии
- ✅ Целые числа (положительные и отрицательные)
- ✅ Дробные числа
- ✅ Числа в научной нотации
- ✅ Пустые массивы
- ✅ Простые массивы
- ✅ Вложенные массивы
- ✅ Объявление констант
- ✅ Использование констант
- ✅ Константные выражения (все операции)
- ✅ Функция len()
- ✅ Обработка ошибок (деление на ноль, неопределённые константы)

## Примеры конфигураций

### Пример 1: Физические расчёты (example_physics.conf)

Конфигурация для физических вычислений, включающая:
- Определение физических констант (скорость света, ускорение свободного падения)
- Параметры эксперимента
- Расчёт кинетической энергии, импульса, пройденного расстояния
- Массивы экспериментальных данных

**Запуск:**
```bash
cat example_physics.conf | python config_parser.py -o physics_results.json
```

### Пример 2: Финансовые расчёты (example_finance.conf)

Конфигурация для финансового анализа проекта:
- Базовые финансовые параметры (инвестиции, выручка, расходы)
- Расчёт прибыли и налогов
- ROI (рентабельность инвестиций)
- Зарплатный фонд
- Квартальные показатели
- Метрики эффективности

**Запуск:**
```bash
cat example_finance.conf | python config_parser.py -o finance_results.json
```

## Структура проекта

```
config-parser-v16/
├── config_parser.py          # Основной парсер
├── test_parser.py            # Модульные тесты
├── example_physics.conf      # Пример 1: Физика
├── example_finance.conf      # Пример 2: Финансы
├── requirements.txt          # Зависимости Python
└── README.md                 # Документация
```

## Обработка ошибок

Парсер выдаёт информативные сообщения об ошибках:

### Синтаксические ошибки
```bash
$ echo "def x =" | python config_parser.py -o out.json
Error: Syntax error: ...
```

### Деление на ноль
```bash
$ echo "def x = 10
.[x / 0]." | python config_parser.py -o out.json
Error: Division by zero
```

### Неопределённая константа
```bash
$ echo "undefined_var" | python config_parser.py -o out.json
Error: Undefined constant: undefined_var
```

## Технические детали

### Используемые технологии
- **Python 3.7+** - основной язык реализации
- **Lark Parser** - библиотека для синтаксического анализа (LALR-парсер)
- **JSON** - выходной формат

### Архитектура
1. **Грамматика** (GRAMMAR) - определяет синтаксис языка в EBNF-подобной нотации
2. **Парсер** (Lark) - строит AST (абстрактное синтаксическое дерево)
3. **Трансформер** (ConfigTransformer) - обходит AST и вычисляет значения
4. **Вывод** - сериализация результата в JSON

### Особенности реализации
- Константы вычисляются на этапе трансляции
- Выражения поддерживают стандартный приоритет операций
- Функция `len()` работает как для массивов, так и для чисел
- Поддержка вложенных структур произвольной глубины
# konfig
